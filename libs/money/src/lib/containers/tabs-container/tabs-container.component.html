<div class="actions">
  <button mat-fab color="primary" (click)="add()">
    <mat-icon>add</mat-icon>
  </button>
</div>

@if (money$ | async; as money) { @if (money.length) {
<mat-tab-group (selectedIndexChange)="tabChange($event)">
  <mat-tab label="{{ GROUPS_LABEL }}">
    <ng-container *ngTemplateOutlet="GROUPS"></ng-container>
  </mat-tab>
  <mat-tab label="{{ DETAILS_LABEL }}">
    <ng-container
      *ngTemplateOutlet="DETAILS; context: { money: money }"
    ></ng-container>
  </mat-tab>
</mat-tab-group>
} @else {
<ng-container *ngTemplateOutlet="EMPTY"> </ng-container>
} }

<ng-template #GROUPS>
  @if(monthsData$ | async; as data) {
  <!-- @if(data.categories.length) { -->
  @if(data.categories; as categories) {
  <table class="next-table mat-elevation-z8">
    <tr>
      <th>Miesiąc</th>
      <th *ngFor="let category of categories">
        <span>{{ category }}</span>
      </th>
    </tr>

    <tr *ngFor="let item of data.months; let i = index; let last = last">
      <td [ngClass]="{ last: last }">{{ item.period }}</td>

      <td *ngFor="let category of categories">
        <span [ngClass]="{ last: last }">
          {{ getPriceByType(item.typePrices, category) }}
        </span>
      </td>
    </tr>
  </table>
  } }
</ng-template>

<ng-template #DETAILS let-money="money">
  <div class="table mat-elevation-z8">
    <table
      mat-table
      [dataSource]="dataSource"
      matSort
      matSortDisableClear
      matSortActive="position"
      matSortDirection="asc"
      multiTemplateDataRows
    >
      <ng-container matColumnDef="fromWho">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          class="custom-header-cell"
        >
          sklep
        </th>
        <td mat-cell *matCellDef="let el">{{ el.fromWho }}</td>
      </ng-container>

      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>cena</th>
        <td mat-cell *matCellDef="let el">{{ el.price }}</td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>kategoria</th>
        <td mat-cell *matCellDef="let el">{{ el.type }}</td>
      </ng-container>

      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>data zakupu</th>
        <td mat-cell *matCellDef="let el">
          {{ el.createdAt | date : 'dd.MM.yyyy' }}
        </td>
      </ng-container>
      <ng-container matColumnDef="isVat">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>VAT</th>
        <td mat-cell *matCellDef="let el">
          <mat-icon *ngIf="el.isVat">done</mat-icon>
          <!-- {{ el.isVat }} -->
        </td>
      </ng-container>
      <ng-container matColumnDef="updatedAt">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>data wpisu</th>
        <td mat-cell *matCellDef="let el">
          {{ el.updatedAt | date : 'dd.MM.yyyy' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let el">
          <div class="actions-buttons">
            <button mat-flat-button (click)="edit(el)">
              <mat-icon color="primary">edit</mat-icon>
            </button>
            <!-- confirmDialog="'Are you sure?'" -->
            <button mat-flat-button (click)="remove(el)">
              <mat-icon color="warn">close</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columns"></tr>
      <tr mat-row *matRowDef="let row; columns: columns"></tr>
    </table>

    <mat-paginator
      #paginator
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      showFirstLastButtons
    >
    </mat-paginator>
  </div>
</ng-template>

<ng-template #EMPTY>
  <div class="no-data">
    <span class="title">Nic tu jeszcze nie ma</span>
    <span class="subtitle">Dodaj coś ☝️ (+)</span>
  </div>
</ng-template>
