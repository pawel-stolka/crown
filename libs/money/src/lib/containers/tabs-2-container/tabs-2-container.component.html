<div>
{{ allYears$ | async | json }}
</div>

<div class="_actions">
  <div class="_filters">
    <!--  -->
    <div class="year" >
      <mat-form-field appearance="outline" *ngIf="allYears$ | async as allYears">
        <mat-label>Rok</mat-label>
        <mat-select>
        <!-- <mat-select [value]="year" (selectionChange)="changeYear(year)"> -->
          @for (option of allYears; track option) {
            <mat-option [value]="option">{{ option }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
      </div>
    <div class="_year">
      <crown-year-selector></crown-year-selector>
      <button mat-stroked-button (click)="addYearFilter(2023)">2023</button>
      <button mat-stroked-button (click)="addYearFilter(2024)">2024</button>
    </div>
    <div class="range-type">
      <ng-container *ngIf="dateRange$ | async as dateRange">
        <div class="dateRange">
          <div class="inline">
            <mat-dialog-content [formGroup]="filters">
              <mat-form-field appearance="outline">
                <mat-label>Od</mat-label>
                <input
                  matInput
                  [matDatepicker]="fromDatepicker"
                  [value]="dateRange.from"
                  #searchInput
                  formControlName="startDate"
                />
                <!-- @if (date?.hasError('required')) {
        <mat-error> Podaj datę! </mat-error>
        } -->

                <mat-datepicker-toggle matSuffix [for]="fromDatepicker">
                </mat-datepicker-toggle>

                <mat-datepicker #fromDatepicker></mat-datepicker>
              </mat-form-field>
            </mat-dialog-content>
            <mat-dialog-content [formGroup]="filters">
              <mat-form-field appearance="outline">
                <mat-label>Do</mat-label>
                <input
                  matInput
                  [matDatepicker]="toDatepicker"
                  [value]="dateRange.to"
                  #searchInput
                  formControlName="endDate"
                />
                <!-- @if (date?.hasError('required')) {
        <mat-error> Podaj datę! </mat-error>
        } -->

                <mat-datepicker-toggle matSuffix [for]="toDatepicker">
                </mat-datepicker-toggle>

                <mat-datepicker #toDatepicker></mat-datepicker>
              </mat-form-field>
            </mat-dialog-content>
            <button mat-stroked-button color="warn" (click)="resetFilters()">
              domyślne
            </button>
          </div>

          <!-- <div>{{ dateRange | json }}</div> -->
        </div>
        <crown-data-filter
          (filter)="typeFilter({ type: $event })"
        ></crown-data-filter>
      </ng-container>
    </div>
  </div>
  <div class="add">
    <button mat-fab color="accent" (click)="add()">
      <mat-icon>add</mat-icon>
    </button>
  </div>
</div>

<hr />

<div class="actions" style="opacity: 0">
  <div class="filters">
    <crown-data-filter
      (filter)="typeFilter({ type: $event })"
    ></crown-data-filter>

    <ng-container *ngIf="dateRange$ | async as dateRange">
      <div class="dateRange">
        <div class="inline">
          <mat-dialog-content [formGroup]="filters">
            <mat-form-field appearance="outline">
              <mat-label>Od</mat-label>
              <input
                matInput
                [matDatepicker]="fromDatepicker"
                [value]="dateRange.from"
                #searchInput
                formControlName="startDate"
              />
              <!-- @if (date?.hasError('required')) {
      <mat-error> Podaj datę! </mat-error>
      } -->

              <mat-datepicker-toggle matSuffix [for]="fromDatepicker">
              </mat-datepicker-toggle>

              <mat-datepicker #fromDatepicker></mat-datepicker>
            </mat-form-field>
          </mat-dialog-content>
          <mat-dialog-content [formGroup]="filters">
            <mat-form-field appearance="outline">
              <mat-label>Do</mat-label>
              <input
                matInput
                [matDatepicker]="toDatepicker"
                [value]="dateRange.to"
                #searchInput
                formControlName="endDate"
              />
              <!-- @if (date?.hasError('required')) {
      <mat-error> Podaj datę! </mat-error>
      } -->

              <mat-datepicker-toggle matSuffix [for]="toDatepicker">
              </mat-datepicker-toggle>

              <mat-datepicker #toDatepicker></mat-datepicker>
            </mat-form-field>
          </mat-dialog-content>

          <button (click)="resetFilters()">resetFilters</button>
        </div>

        <div>{{ dateRange | json }}</div>
      </div>
    </ng-container>
  </div>
  <button (click)="addYearFilter(2023)">2023</button>
  <button (click)="addYearFilter(2024)">2024</button>
  <button mat-fab color="accent" (click)="add()">
    <mat-icon>add</mat-icon>
  </button>
</div>

<!-- <ng-container *ngIf="filters$ | async as filters">
  <div class="help">
    <div>filters$: {{ filters | json }}</div>
    <div>startDate: {{ filters.startDate | json }}</div>
    <div>endDate: {{ filters.endDate | json }}</div>
    <div>type: {{ filters.type | json }}</div>
    <div>year: {{ filters.year | json }}</div>
  </div>
</ng-container> -->

<ng-container *ngIf="filteredMoney$ | async as money; else NO_DATA">
  <ng-container *ngIf="money.length > 0; then DATA; else EMPTY"> </ng-container>
</ng-container>

<!-- <pre>{{ monthsData2$ | async | json }}</pre> -->

<ng-template #DATA>
  <mat-tab-group (selectedIndexChange)="tabChange($event)">
    <mat-tab label="{{ NEW_GROUPS_LABEL }}">
      <crown-new-groups [data]="monthsData2$ | async"></crown-new-groups>
    </mat-tab>
    <!-- <mat-tab label="{{ GROUPS_LABEL }}">
      <crown-groups-tab
        [data]="monthsData2$ | async"
        [filtered]="!!(filterPhrase$ | async)"
      ></crown-groups-tab>
    </mat-tab> -->
    <mat-tab label="{{ DETAILS_LABEL }}">
      <!-- <crown-details-tab
        [money]="(monthsData2$ | async) || undefined"
        [filter]="this.dataSource.filter"
      ></crown-details-tab> -->
      <crown-new-details-tab
        [money]="(filteredMoney$ | async) || undefined"
      ></crown-new-details-tab>
    </mat-tab>
  </mat-tab-group>
  <!-- <div *ngIf="pendingFetch$ | async" class="directory-content-loader">
    <mat-spinner [strokeWidth]="2"></mat-spinner>
  </div> -->
</ng-template>

<ng-template #EMPTY>
  <div class="empty">
    <span class="title">Nie znaleziono.</span>
  </div>
</ng-template>

<ng-template #NO_DATA>
  <div class="no-data">
    <span class="title">Nic tu jeszcze nie ma</span>
    <span class="subtitle">Dodaj coś ☝️ (+)</span>
  </div>
</ng-template>
